<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETL Uploader Web App</title>
    <!-- Tailwind CSS for modern styling -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Google Fonts for a clean look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">

    <!-- Main Application Card -->
    <div class="bg-white p-8 rounded-xl shadow-lg text-center max-w-lg w-full m-4">
        
        <!-- Header Section -->
        <h1 class="text-3xl font-bold text-gray-900 mb-2">ETL Processing App</h1>
        <p class="text-gray-600 mb-8">
            Select the daily raw data Excel file. The app will process it and update the master Google Sheet.
        </p>
        
        <!-- File Input -->
        <div class="mb-6">
            <input type="file" id="fileInput" class="block w-full text-sm text-gray-500
                file:mr-4 file:py-3 file:px-5
                file:rounded-full file:border-0
                file:text-sm file:font-semibold
                file:bg-blue-50 file:text-blue-700
                hover:file:bg-blue-100
                cursor-pointer"/>
        </div>
        
        <!-- Action Button -->
        <button id="uploadButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg w-full text-lg transition-all duration-300 disabled:bg-gray-400">
            Process and Update Sheet
        </button>
      
        <!-- Status Display Area -->
        <div id="status" class="mt-6 text-gray-700 font-medium h-6">
            <!-- Messages like "Processing..." or "Success!" will appear here -->
        </div>

    </div>

    <!-- 
      CLIENT-SIDE JAVASCRIPT
      This script handles the user interaction and sends data to the back-end.
    -->
    <script>
        // --- IMPORTANT CONFIGURATION ---
        // You MUST replace this with the URL you get after deploying your Google Apps Script.
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzoToMerAYzOfFFhDic30Z7UMXLK35FdRVd8GzEOJrd7_T2Sq7YzbnaLHSlZeurj-Zrcw/exec";
        // -----------------------------

        const uploadButton = document.getElementById('uploadButton');
        const fileInput = document.getElementById('fileInput');
        const statusDiv = document.getElementById('status');

        uploadButton.addEventListener('click', () => {
            const file = fileInput.files[0];
            if (!file) {
                statusDiv.innerText = "Please select a file first!";
                return;
            }

            statusDiv.innerText = "Processing... This may take a moment.";
            uploadButton.disabled = true;
            
            const reader = new FileReader();
            reader.onload = (event) => {
                const fileContent = event.target.result.split(',')[1];
                const fileData = {
                    name: file.name,
                    content: fileContent
                };
              
                // Use a standard 'fetch' call to send data to the Apps Script back-end
                fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(fileData),
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8', // Apps Script requires text/plain for POST body
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showSuccess(data.message);
                    } else {
                        showError({ message: data.message });
                    }
                })
                .catch(err => {
                    showError({ message: 'A network error occurred. Please try again.' });
                    console.error('Fetch Error:', err);
                });
            };
            reader.readAsDataURL(file);
        });

        function showSuccess(message) {
            statusDiv.innerText = message;
            uploadButton.disabled = false;
            fileInput.value = "";
        }

        function showError(error) {
            statusDiv.innerText = "Error: " + error.message;
            uploadButton.disabled = false;
        }
    </script>
</body>
</html>

